<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bike Curious Route Planner - In Development</title>

    <link href="{{ url_for('static', filename='routestyle.css') }}" type="text/css" rel="stylesheet">
</head>
<body>

<!-- divs for page navigation -->
<div id="navigation">
  <img id="logo" src="static/images/white_grey_dublinbikes.png">
  <div id="homenav">
    <a id="homelink" href="{{ url_for('homepage') }}">Home</a>
  </div>

  <div id="infonav">
      <a id="infolink" href="{{ url_for('info_page') }}">Stations</a>
  </div>

  <div id="routenav">
    <a id="routelink" href="{{ url_for('route_planner') }}">Route Planner</a>
  </div>
</div>

<h3>Select station:</h3>

<label for="start">Start:</label>
<select id="start"></select>

<label for="dest">Destination:</label>
<select id="dest"></select>

<br><br>

<div id="map" style="height: 800px"></div>

<script>

let map;

function initMap() {

  var directionsService = new google.maps.DirectionsService;
  var directionsRenderer = new google.maps.DirectionsRenderer;

  // fetching the static data
  fetch("/stations").then(response => {
      return response.json();
      }).then(data => {
      console.log("data ", data);

  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 53.349804, lng: -6.260310 },
    zoom: 13,
    });
    directionsRenderer.setMap(map);

  var onChange = function() {
    displayRoute(directionsService, directionsRenderer);
  };
  document.getElementById("start").addEventListener('change', onChange);
  document.getElementById("dest").addEventListener('change', onChange);

  var stationsList = "";

  // iterating over each station
  data.forEach(station => {
    stationsList += "<option value='" + station.latitude + "," + station.longitude + "'>" + station.address + "</option>";
    });

  // filling in the stations drop downs
  document.getElementById("start").innerHTML = stationsList;
  document.getElementById("dest").innerHTML = stationsList;

  // iterating over each station
  data.forEach(station => {

    // adding the markers
    const marker = new google.maps.Marker({
      position: { lat: parseFloat(station.latitude), lng: parseFloat(station.longitude) },
      map: map,
    });
    });

   });
}


// function to display the selected route on the map
function displayRoute(directionsService, directionsRenderer) {
    var startPos = document.getElementById("start").value;
    var destPos = document.getElementById("dest").value;

    directionsService.route({
      origin: startPos,
      destination: destPos,
      travelMode: 'BICYCLING'
    }, function(response, status) {
      if (status === 'OK') {
        directionsRenderer.setDirections(response);
      } else {
        window.alert('Oops, ' + status);
      }
    });
}

</script>

<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBoy1x8NH5BZFhA86GFgJk7tFyrnPhGbhw&callback=initMap&libraries=&v=weekly"
      async>
</script>


</body>
</html>